[gd_scene load_steps=101 format=3]

[ext_resource path="res://resources/characters/zombie/male/Attack (1).png" type="Texture2D" id=1]
[ext_resource path="res://resources/characters/zombie/male/Attack (2).png" type="Texture2D" id=2]
[ext_resource path="res://resources/characters/zombie/male/Attack (3).png" type="Texture2D" id=3]
[ext_resource path="res://resources/characters/zombie/male/Attack (4).png" type="Texture2D" id=4]
[ext_resource path="res://resources/characters/zombie/male/Attack (5).png" type="Texture2D" id=5]
[ext_resource path="res://resources/characters/zombie/male/Attack (6).png" type="Texture2D" id=6]
[ext_resource path="res://resources/characters/zombie/male/Attack (7).png" type="Texture2D" id=7]
[ext_resource path="res://resources/characters/zombie/male/Attack (8).png" type="Texture2D" id=8]
[ext_resource path="res://resources/characters/zombie/female/Attack (1).png" type="Texture2D" id=9]
[ext_resource path="res://resources/characters/zombie/female/Attack (2).png" type="Texture2D" id=10]
[ext_resource path="res://resources/characters/zombie/female/Attack (3).png" type="Texture2D" id=11]
[ext_resource path="res://resources/characters/zombie/female/Attack (4).png" type="Texture2D" id=12]
[ext_resource path="res://resources/characters/zombie/female/Attack (5).png" type="Texture2D" id=13]
[ext_resource path="res://resources/characters/zombie/female/Attack (6).png" type="Texture2D" id=14]
[ext_resource path="res://resources/characters/zombie/female/Attack (7).png" type="Texture2D" id=15]
[ext_resource path="res://resources/characters/zombie/female/Attack (8).png" type="Texture2D" id=16]
[ext_resource path="res://resources/characters/zombie/male/Idle (1).png" type="Texture2D" id=17]
[ext_resource path="res://resources/characters/zombie/male/Idle (2).png" type="Texture2D" id=18]
[ext_resource path="res://resources/characters/zombie/male/Idle (3).png" type="Texture2D" id=19]
[ext_resource path="res://resources/characters/zombie/male/Idle (4).png" type="Texture2D" id=20]
[ext_resource path="res://resources/characters/zombie/male/Idle (5).png" type="Texture2D" id=21]
[ext_resource path="res://resources/characters/zombie/male/Idle (6).png" type="Texture2D" id=22]
[ext_resource path="res://resources/characters/zombie/male/Idle (7).png" type="Texture2D" id=23]
[ext_resource path="res://resources/characters/zombie/male/Idle (8).png" type="Texture2D" id=24]
[ext_resource path="res://resources/characters/zombie/male/Idle (9).png" type="Texture2D" id=25]
[ext_resource path="res://resources/characters/zombie/male/Idle (10).png" type="Texture2D" id=26]
[ext_resource path="res://resources/characters/zombie/male/Idle (11).png" type="Texture2D" id=27]
[ext_resource path="res://resources/characters/zombie/male/Idle (12).png" type="Texture2D" id=28]
[ext_resource path="res://resources/characters/zombie/male/Idle (13).png" type="Texture2D" id=29]
[ext_resource path="res://resources/characters/zombie/male/Idle (14).png" type="Texture2D" id=30]
[ext_resource path="res://resources/characters/zombie/male/Idle (15).png" type="Texture2D" id=31]
[ext_resource path="res://resources/characters/zombie/female/Idle (1).png" type="Texture2D" id=32]
[ext_resource path="res://resources/characters/zombie/female/Idle (2).png" type="Texture2D" id=33]
[ext_resource path="res://resources/characters/zombie/female/Idle (3).png" type="Texture2D" id=34]
[ext_resource path="res://resources/characters/zombie/female/Idle (4).png" type="Texture2D" id=35]
[ext_resource path="res://resources/characters/zombie/female/Idle (5).png" type="Texture2D" id=36]
[ext_resource path="res://resources/characters/zombie/female/Idle (6).png" type="Texture2D" id=37]
[ext_resource path="res://resources/characters/zombie/female/Idle (7).png" type="Texture2D" id=38]
[ext_resource path="res://resources/characters/zombie/female/Idle (8).png" type="Texture2D" id=39]
[ext_resource path="res://resources/characters/zombie/female/Idle (9).png" type="Texture2D" id=40]
[ext_resource path="res://resources/characters/zombie/female/Idle (10).png" type="Texture2D" id=41]
[ext_resource path="res://resources/characters/zombie/female/Idle (11).png" type="Texture2D" id=42]
[ext_resource path="res://resources/characters/zombie/female/Idle (12).png" type="Texture2D" id=43]
[ext_resource path="res://resources/characters/zombie/female/Idle (13).png" type="Texture2D" id=44]
[ext_resource path="res://resources/characters/zombie/female/Idle (14).png" type="Texture2D" id=45]
[ext_resource path="res://resources/characters/zombie/female/Idle (15).png" type="Texture2D" id=46]
[ext_resource path="res://resources/characters/zombie/female/Dead (1).png" type="Texture2D" id=47]
[ext_resource path="res://resources/characters/zombie/female/Dead (2).png" type="Texture2D" id=48]
[ext_resource path="res://resources/characters/zombie/female/Dead (3).png" type="Texture2D" id=49]
[ext_resource path="res://resources/characters/zombie/female/Dead (4).png" type="Texture2D" id=50]
[ext_resource path="res://resources/characters/zombie/female/Dead (5).png" type="Texture2D" id=51]
[ext_resource path="res://resources/characters/zombie/female/Dead (6).png" type="Texture2D" id=52]
[ext_resource path="res://resources/characters/zombie/female/Dead (7).png" type="Texture2D" id=53]
[ext_resource path="res://resources/characters/zombie/female/Dead (8).png" type="Texture2D" id=54]
[ext_resource path="res://resources/characters/zombie/female/Dead (9).png" type="Texture2D" id=55]
[ext_resource path="res://resources/characters/zombie/female/Dead (10).png" type="Texture2D" id=56]
[ext_resource path="res://resources/characters/zombie/female/Dead (11).png" type="Texture2D" id=57]
[ext_resource path="res://resources/characters/zombie/female/Dead (12).png" type="Texture2D" id=58]
[ext_resource path="res://resources/characters/zombie/male/Walk (1).png" type="Texture2D" id=59]
[ext_resource path="res://resources/characters/zombie/male/Walk (2).png" type="Texture2D" id=60]
[ext_resource path="res://resources/characters/zombie/male/Walk (3).png" type="Texture2D" id=61]
[ext_resource path="res://resources/characters/zombie/male/Walk (4).png" type="Texture2D" id=62]
[ext_resource path="res://resources/characters/zombie/male/Walk (5).png" type="Texture2D" id=63]
[ext_resource path="res://resources/characters/zombie/male/Walk (6).png" type="Texture2D" id=64]
[ext_resource path="res://resources/characters/zombie/male/Walk (7).png" type="Texture2D" id=65]
[ext_resource path="res://resources/characters/zombie/male/Walk (8).png" type="Texture2D" id=66]
[ext_resource path="res://resources/characters/zombie/male/Walk (9).png" type="Texture2D" id=67]
[ext_resource path="res://resources/characters/zombie/male/Walk (10).png" type="Texture2D" id=68]
[ext_resource path="res://resources/characters/zombie/female/Walk (1).png" type="Texture2D" id=69]
[ext_resource path="res://resources/characters/zombie/female/Walk (2).png" type="Texture2D" id=70]
[ext_resource path="res://resources/characters/zombie/female/Walk (3).png" type="Texture2D" id=71]
[ext_resource path="res://resources/characters/zombie/female/Walk (4).png" type="Texture2D" id=72]
[ext_resource path="res://resources/characters/zombie/female/Walk (5).png" type="Texture2D" id=73]
[ext_resource path="res://resources/characters/zombie/female/Walk (6).png" type="Texture2D" id=74]
[ext_resource path="res://resources/characters/zombie/female/Walk (7).png" type="Texture2D" id=75]
[ext_resource path="res://resources/characters/zombie/female/Walk (8).png" type="Texture2D" id=76]
[ext_resource path="res://resources/characters/zombie/female/Walk (9).png" type="Texture2D" id=77]
[ext_resource path="res://resources/characters/zombie/female/Walk (10).png" type="Texture2D" id=78]
[ext_resource path="res://resources/characters/zombie/male/Dead (1).png" type="Texture2D" id=79]
[ext_resource path="res://resources/characters/zombie/male/Dead (2).png" type="Texture2D" id=80]
[ext_resource path="res://resources/characters/zombie/male/Dead (3).png" type="Texture2D" id=81]
[ext_resource path="res://resources/characters/zombie/male/Dead (4).png" type="Texture2D" id=82]
[ext_resource path="res://resources/characters/zombie/male/Dead (5).png" type="Texture2D" id=83]
[ext_resource path="res://resources/characters/zombie/male/Dead (6).png" type="Texture2D" id=84]
[ext_resource path="res://resources/characters/zombie/male/Dead (7).png" type="Texture2D" id=85]
[ext_resource path="res://resources/characters/zombie/male/Dead (8).png" type="Texture2D" id=86]
[ext_resource path="res://resources/characters/zombie/male/Dead (9).png" type="Texture2D" id=87]
[ext_resource path="res://resources/characters/zombie/male/Dead (10).png" type="Texture2D" id=88]
[ext_resource path="res://resources/characters/zombie/male/Dead (11).png" type="Texture2D" id=89]
[ext_resource path="res://resources/characters/zombie/male/Dead (12).png" type="Texture2D" id=90]

[sub_resource type="GDScript" id=1]
script/source = "extends \"res://scripts/generic_character_behaviour.gd\"

# variables
var bubbleSpaceReact
var bubbleSpaceStopReact

export var genders = ['female', 'male']
export var allowMove = true

var moveDirections = [-1, 1]
var defaultMaxSpeed
var stopMove = false
var no_collision_group = [\"bullet\"]

@onready var healthBar = get_node(\"HealthProgressBar\")
@onready var energyBar = get_node(\"EnergyProgressBar\")



# set the default values as soon as scene is ready
func _ready():
	type = \"zombie\"
	gender = genders[randi()%genders.size()] # random gender
	playerSprite = get_node(\"AnimatedSprite2D\")
	._change_sprite_animation(\"idle\")
	bubbleSpaceReact = get_node(\"React - Area2D\")
	bubbleSpaceStopReact = get_node(\"StopReact - Area2D2\")
	repeatFrames = true
	defaultMaxSpeed = maxSpeed
	invincibleTime = 1
	dazedTime = 1.2
	healthBar.max_value = maxHealth
	energyBar.max_value = maxEnergy
	blood_colour = Color(\"#6a4040\")
	self.scale = characterScale
	
	if (gender == 'female'):
		playerSprite.scale = Vector2(0.13, 0.13)
		get_node(\"StopReact - Area2D2/FemaleCollisionShape2D\").disabled = false
		get_node(\"StopReact - Area2D2/MaleCollisionShape2D\").disabled = true
	
	_subscribe_to_signals()
	set_process(true)


func _subscribe_to_signals():
	var enemy_barriers = get_tree().get_nodes_in_group(\"barrier\")
	for i in enemy_barriers:
		i.connect(\"touchedBarrier\", Callable(self, \"change_direction\"))
		
	var enemy_saws = get_tree().get_nodes_in_group(\"enemy_saw\")
	for i in enemy_saws:
		i.connect(\"touchedSaw\", Callable(self, \"change_direction\"))


func _physics_process(delta):
	._animate_player(delta)
	
	if (!dazed):
		if (movementDirection == 0 and !stopMove and allowMove):
			if (moveDirections[randi()%2] == -1):
				._move_left()
			else:
				._move_right()
		
		#warning-ignore:return_value_discarded
		move_and_collide(Vector2(0, velocity.y))
		var collidedObject2 = move_and_collide(Vector2(velocity.x, 0))
		
		if (collidedObject2 and health > 0):
			if (collidedObject2.normal == Vector2(0,-1)):
				playerSpeedY = 0
			if (collidedObject2.normal == Vector2(1,0) and !_check_collision_group(collidedObject2.collider)):
				._move_right()
			elif (collidedObject2.normal == Vector2(-1,0) and !_check_collision_group(collidedObject2.collider)):
				._move_left()

func _process(delta):
	
	healthBar.value = health
	energyBar.value = energy
		
	if (!dazed):
		_areaCheck()
		
	if(health <= 0):
		healthBar.hide()
		energyBar.hide()
		self.get_node(\"CollisionShape2D\").disabled = true
	elif(action2 or dazed):
		if (!dazed and action2):
			._change_sprite_animation(\"attack\")
			repeatFrames = true
		if(dazed):
			._change_sprite_animation(\"idle\")
			movementDirection = 0
			action1 = false
			action2 = false
			action3 = false
	else:
		if (movementDirection == 0):
			._change_sprite_animation(\"idle\")
		else:
			._change_sprite_animation(\"walk\")
			repeatFrames = true
			maxSpeed = defaultMaxSpeed


func _check_collision_group(collider):
	for val in no_collision_group:
		if (collider.is_in_group(val)):
			return true
	
	return false


func _areaCheck():
	if (health > 0):
		var area1 = bubbleSpaceReact.get_overlapping_bodies()
		action2 = false
		if (area1.size() != 0):
			for body in area1:
#				Move zombie in character direction 
				if (body.is_in_group(\"main_character\")):
					action2 = true
					
					if (!stopMove):
						if (body.position.x < self.position.x):
							._move_left()
						elif (body.position.x > self.position.x):
							._move_right()
					else:
						if (body.position.x < self.position.x):
							facingDirection = -1
						elif (body.position.x > self.position.x):
							facingDirection = 1
						movementDirection = 0
					
					if (maxSpeed <= defaultMaxSpeed):
						maxSpeed *= 2
				elif (body.is_in_group(\"enemy_saw\")):
					change_direction(self, body)
		
		var area2 = bubbleSpaceStopReact.get_overlapping_bodies()
		stopMove = false
		if (area2.size() != 0):
			for body in area2:
#				Move zombie in character direction 
				if (body.is_in_group(\"main_character\")):
					stopMove = true


func change_direction(object1, object2):
	if (self == object1):
		if (object1.is_in_group(\"barrier\") and action2):
			# ignore the move
			pass
		else:
			if (self.position.x < object2.position.x):
				._move_left()
			else:
				._move_right()"

[sub_resource type="RectangleShape2D" id=2]
extents = Vector2( 0.575264, 36.62 )

[sub_resource type="SpriteFrames" id=3]
animations = [ {
"frames": [ ExtResource( 1 ), ExtResource( 2 ), ExtResource( 3 ), ExtResource( 4 ), ExtResource( 5 ), ExtResource( 6 ), ExtResource( 7 ), ExtResource( 8 ) ],
"loop": true,
"name": "male_zombie_attack",
"speed": 5.0
}, {
"frames": [ ExtResource( 9 ), ExtResource( 10 ), ExtResource( 11 ), ExtResource( 12 ), ExtResource( 13 ), ExtResource( 14 ), ExtResource( 15 ), ExtResource( 16 ) ],
"loop": true,
"name": "female_zombie_attack",
"speed": 5.0
}, {
"frames": [ ExtResource( 17 ), ExtResource( 18 ), ExtResource( 19 ), ExtResource( 20 ), ExtResource( 21 ), ExtResource( 22 ), ExtResource( 23 ), ExtResource( 24 ), ExtResource( 25 ), ExtResource( 26 ), ExtResource( 27 ), ExtResource( 28 ), ExtResource( 29 ), ExtResource( 30 ), ExtResource( 31 ) ],
"loop": true,
"name": "male_zombie_idle",
"speed": 5.0
}, {
"frames": [ ExtResource( 32 ), ExtResource( 33 ), ExtResource( 34 ), ExtResource( 35 ), ExtResource( 36 ), ExtResource( 37 ), ExtResource( 38 ), ExtResource( 39 ), ExtResource( 40 ), ExtResource( 41 ), ExtResource( 42 ), ExtResource( 43 ), ExtResource( 44 ), ExtResource( 45 ), ExtResource( 46 ) ],
"loop": true,
"name": "female_zombie_idle",
"speed": 5.0
}, {
"frames": [ ExtResource( 47 ), ExtResource( 48 ), ExtResource( 49 ), ExtResource( 50 ), ExtResource( 51 ), ExtResource( 52 ), ExtResource( 53 ), ExtResource( 54 ), ExtResource( 55 ), ExtResource( 56 ), ExtResource( 57 ), ExtResource( 58 ) ],
"loop": true,
"name": "female_zombie_dead",
"speed": 5.0
}, {
"frames": [ ExtResource( 59 ), ExtResource( 60 ), ExtResource( 61 ), ExtResource( 62 ), ExtResource( 63 ), ExtResource( 64 ), ExtResource( 65 ), ExtResource( 66 ), ExtResource( 67 ), ExtResource( 68 ) ],
"loop": true,
"name": "male_zombie_walk",
"speed": 5.0
}, {
"frames": [ ExtResource( 69 ), ExtResource( 70 ), ExtResource( 71 ), ExtResource( 72 ), ExtResource( 73 ), ExtResource( 74 ), ExtResource( 75 ), ExtResource( 76 ), ExtResource( 77 ), ExtResource( 78 ) ],
"loop": true,
"name": "female_zombie_walk",
"speed": 4.98
}, {
"frames": [ ExtResource( 79 ), ExtResource( 80 ), ExtResource( 81 ), ExtResource( 82 ), ExtResource( 83 ), ExtResource( 84 ), ExtResource( 85 ), ExtResource( 86 ), ExtResource( 87 ), ExtResource( 88 ), ExtResource( 89 ), ExtResource( 90 ) ],
"loop": true,
"name": "male_zombie_dead",
"speed": 5.0
} ]

[sub_resource type="RectangleShape2D" id=4]
extents = Vector2( 112.876, 32.9578 )

[sub_resource type="RectangleShape2D" id=5]
extents = Vector2( 21.948, 32.4114 )

[sub_resource type="RectangleShape2D" id=6]
extents = Vector2( 22.8576, 33.7305 )

[sub_resource type="StyleBoxFlat" id=7]
bg_color = Color( 0.866667, 0.0901961, 0.0901961, 1 )

[sub_resource type="StyleBoxFlat" id=8]

[sub_resource type="StyleBoxFlat" id=9]
bg_color = Color( 0.113725, 0.223529, 0.647059, 1 )

[sub_resource type="StyleBoxFlat" id=10]

[node name="Enemy" type="CharacterBody2D" groups=[
"character",
"enemy_character",
]]
position = Vector2( -0.0189209, 1.0983 )
scale = Vector2( 1.2, 1.2 )
script = SubResource( 1 )
maxJumpCount = 0
maxSpeed = 150
energy = 10
maxEnergy = 10
health = 20
maxHealth = 20
action1Damage = 0
action3Damage = 0
characterScale = Vector2( 1.2, 1.2 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
editor/display_folded = true
position = Vector2( -1.51142, -6.65097 )
scale = Vector2( 5.65976, 0.847504 )
shape = SubResource( 2 )

[node name="AnimatedSprite" type="AnimatedSprite2D" parent="."]
editor/display_folded = true
position = Vector2( 0.715809, -5.54256 )
scale = Vector2( 0.15, 0.15 )
frames = SubResource( 3 )
animation = "female_zombie_walk"
frame = 4
speed_scale = 2.0

[node name="React - Area2D" type="Area2D" parent="."]

[node name="CollisionShape2D" type="CollisionShape2D" parent="React - Area2D"]
position = Vector2( 0, -10.6946 )
shape = SubResource( 4 )

[node name="StopReact - Area2D2" type="Area2D" parent="." groups=[
"enemy_attack",
]]

[node name="MaleCollisionShape2D" type="CollisionShape2D" parent="StopReact - Area2D2"]
position = Vector2( -2.42448, -2.8969 )
shape = SubResource( 5 )

[node name="FemaleCollisionShape2D" type="CollisionShape2D" parent="StopReact - Area2D2"]
position = Vector2( -1.84445, -2.17231 )
shape = SubResource( 6 )
disabled = true

[node name="HealthProgressBar" type="ProgressBar" parent="."]
margin_left = -18.4746
margin_top = -63.6433
margin_right = 104.525
margin_bottom = -32.6433
rect_scale = Vector2( 0.3, 0.3 )
custom_styles/fg = SubResource( 7 )
custom_styles/bg = SubResource( 8 )
percent_visible = false

[node name="EnergyProgressBar" type="ProgressBar" parent="."]
margin_left = -18.4167
margin_top = -53.3971
margin_right = 104.583
margin_bottom = -22.3971
rect_scale = Vector2( 0.3, 0.3 )
custom_styles/fg = SubResource( 9 )
custom_styles/bg = SubResource( 10 )
custom_colors/font_color = Color( 0, 0, 0, 1 )
percent_visible = false
